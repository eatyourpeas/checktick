{% extends 'base.html' %}
{% load i18n %}
{% block title %}{% trans "Survey Invitations" %} - {{ survey.name }}{% endblock %}
{% block content %}
<div class="prose">
  {% trans "Surveys" as bc_surveys %}
  {% trans "Survey Dashboard" as bc_survey_dashboard %}
  {% trans "Invitations" as bc_invitations %}
  {% include 'components/breadcrumbs.html' with crumb1_label=bc_surveys crumb1_href="/surveys/" crumb2_label=bc_survey_dashboard crumb2_href="/surveys/"|add:survey.slug|add:"/dashboard/" crumb3_label=bc_invitations %}
  <h2>{{ survey.name }} — {% trans "Invitations" %}</h2>
</div>

<div class="mt-4">
  <div class="flex flex-wrap gap-2 mb-4">
    <span class="badge badge-lg badge-outline">{% trans "Total" %}: {{ invites|length }}</span>
    <span class="badge badge-lg badge-success">{% trans "Completed" %}: {{ completed_count }}</span>
    <span class="badge badge-lg badge-warning">{% trans "Pending" %}: {{ pending_count }}</span>
  </div>

  <p class="mb-3 opacity-70">{% blocktrans %}The list below shows all invited email addresses and their completion status.{% endblocktrans %}</p>
  {% if invites %}
    <div class="overflow-x-auto">
      <table class="table w-full">
        <thead>
          <tr>
            <th>{% trans "Status" %}</th>
            <th>{% trans "Invited at" %}</th>
            <th>{% trans "Email" %}</th>
            <th>{% trans "Completed at" %}</th>
            <th>{% trans "Actions" %}</th>
          </tr>
        </thead>
        <tbody>
          {% for item in invites %}
          <tr class="{% if item.is_completed %}opacity-60{% endif %}">
            <td>
              {% if item.is_completed %}
                <span class="badge badge-success badge-sm">{% trans "Completed" %}</span>
              {% else %}
                <span class="badge badge-warning badge-sm">{% trans "Pending" %}</span>
              {% endif %}
            </td>
            <td>{{ item.token.created_at|date:"d M Y H:i" }}</td>
            <td>{{ item.email }}</td>
            <td>
              {% if item.completed_at %}
                {{ item.completed_at|date:"d M Y H:i" }}
              {% else %}
                <span class="opacity-50">—</span>
              {% endif %}
            </td>
            <td>
              {% if not item.is_completed %}
              <form method="post" action="{% url 'surveys:invite_resend' slug=survey.slug token_id=item.token.id %}" class="inline" onsubmit="return confirm('{% trans "Resend invitation to" %} {{ item.email }}?');">
                {% csrf_token %}
                <button type="submit" class="btn btn-xs btn-outline btn-primary">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                  </svg>
                  {% trans "Resend" %}
                </button>
              </form>
              {% else %}
              <span class="opacity-50 text-sm">{% trans "No action needed" %}</span>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <div class="alert alert-info">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
      <span>{% trans "No invitations have been sent yet. You can send invitations from the publication settings page." %}</span>
    </div>
  {% endif %}

  <p class="mt-4"><a class="btn btn-primary hover:bg-primary-focus transition-colors" href="{% url 'surveys:dashboard' slug=survey.slug %}">{% trans "Back to dashboard" %}</a></p>
</div>
{% endblock %}
