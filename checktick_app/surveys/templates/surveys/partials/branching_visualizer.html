{% load static %}

<!-- Branching Flow Visualizer -->
<div class="branching-visualizer bg-base-100 rounded-lg border border-base-300 p-4" data-survey-slug="{{ survey.slug }}">
  <div class="flex items-center justify-between mb-4">
    <h3 class="text-lg font-semibold flex items-center gap-2">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
      </svg>
      <span>Branching Flow</span>
    </h3>
    <button type="button" class="btn btn-xs btn-ghost fullscreen-btn">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" />
      </svg>
    </button>
  </div>

  <!-- Legend -->
  <div class="flex flex-wrap gap-3 mb-4 text-xs">
    <div class="flex items-center gap-1.5">
      <div class="w-3 h-3 rounded-full bg-primary"></div>
      <span>Question</span>
    </div>
    <div class="flex items-center gap-1.5">
      <div class="w-8 h-0.5 bg-primary"></div>
      <span class="text-primary">▶</span>
      <span>Show</span>
    </div>
    <div class="flex items-center gap-1.5">
      <div class="w-8 h-0.5 bg-primary"></div>
      <svg class="w-3 h-3 text-primary" fill="currentColor" viewBox="0 0 24 24">
        <path d="M5 5l10 7-10 7V5zm10 0l10 7-10 7V5z"/>
      </svg>
      <span>Jump</span>
    </div>
    <div class="flex items-center gap-1.5">
      <div class="w-8 h-0.5 bg-primary"></div>
      <span class="text-primary">✕</span>
      <span>Skip</span>
    </div>
    <div class="flex items-center gap-1.5">
      <div class="w-8 h-0.5 bg-primary"></div>
      <span class="text-primary">■</span>
      <span>End</span>
    </div>
  </div>

  <!-- Canvas container -->
  <div class="flow-canvas-container relative overflow-auto border border-base-300 rounded bg-base-200/30" style="height: 600px;">
    <canvas class="flow-canvas"></canvas>
  </div>
</div>

<style>
  .branching-visualizer {
    --node-width: 200px;
    --node-height: 60px;
    --vertical-spacing: 100px;
    --horizontal-spacing: 250px;
  }

  .flow-canvas-container {
    cursor: grab;
  }

  .flow-canvas-container:active {
    cursor: grabbing;
  }

  .flow-canvas {
    display: block;
    width: 100%;
  }
</style>

<script src="{% static 'js/branching-visualizer.js' %}" defer></script>
