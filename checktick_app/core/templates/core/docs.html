{% extends "base.html" %}
{% load static %}
{% block title %}Documentation ¬∑ {{ block.super }}{% endblock %}
{% block content %}
<div class="grid grid-cols-12 gap-6">
  <aside class="col-span-12 lg:col-span-3">
    <div class="card bg-base-100 shadow sticky top-4">
      <div class="card-body p-4">
        <h2 class="card-title text-lg mb-2">Documentation</h2>

        {# Search component - add this #}
        <div id="doc-search-container" class="mb-4"></div>

        <nav class="docs-nav" style="max-height: calc(100vh - 16rem); overflow-y: auto;">
          {% for item in pages %}
            {% if item.standalone %}
              {# Standalone link item #}
              <div class="mb-2">
                <a href="{% url 'core:docs_page' slug=item.slug %}"
                   class="flex items-center text-sm px-2 py-1 rounded hover:bg-base-200 transition-colors {% if active_slug == item.slug %}bg-base-200 font-semibold{% endif %}">
                  {% if item.icon %}<span class="mr-2">{{ item.icon }}</span>{% endif %}
                  {{ item.title }}
                </a>
              </div>
            {% else %}
              {# Category with collapsible items #}
              <div class="docs-category mb-3" data-category="{{ item.title|slugify }}">
                <button class="docs-category-toggle w-full flex items-center justify-between text-left font-semibold text-sm px-2 py-1 rounded hover:bg-base-200 transition-colors"
                        aria-expanded="true"
                        aria-controls="category-{{ item.title|slugify }}">
                  <span>
                    {% if item.icon %}<span class="mr-1">{{ item.icon }}</span>{% endif %}
                    {{ item.title }}
                  </span>
                  <svg class="docs-chevron w-4 h-4 transition-transform duration-200"
                       fill="none"
                       stroke="currentColor"
                       viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                  </svg>
                </button>
                <ul class="docs-category-items menu menu-sm pl-2 mt-1"
                    id="category-{{ item.title|slugify }}"
                    style="display: block;">
                  {% for page in item.pages %}
                    <li>
                      <a class="text-sm {% if active_slug == page.slug %}active font-semibold{% endif %}"
                         href="{% url 'core:docs_page' slug=page.slug %}">
                        {{ page.title }}
                      </a>
                    </li>
                  {% endfor %}
                </ul>
              </div>
            {% endif %}
          {% endfor %}
          {# Link to DSPT Compliance section #}
          <div class="mt-3 pt-2 border-t border-base-300">
            <a href="{% url 'core:compliance_index' %}"
               class="flex items-center text-sm px-2 py-1.5 rounded bg-primary/10 hover:bg-primary/20 transition-colors text-primary font-medium">
              <span class="mr-2">üõ°Ô∏è</span>
              DSPT Compliance
              <svg class="w-4 h-4 ml-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
              </svg>
            </a>
          </div>
        </nav>
      </div>
    </div>
  </aside>
  <section class="col-span-12 lg:col-span-9">
    <article class="prose max-w-none">
      {{ html|safe }}
    </article>
  </section>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/docs-navigation.js' %}" nonce="{{ request.csp_nonce }}"></script>
{# Add search JS #}
<script src="{% static 'js/docs-search.js' %}" nonce="{{ request.csp_nonce }}"></script>
{% endblock %}

{% block extra_css %}
<style nonce="{{ request.csp_nonce }}">
.docs-nav::-webkit-scrollbar {
  width: 6px;
}

.docs-nav::-webkit-scrollbar-track {
  background: transparent;
}

.docs-nav::-webkit-scrollbar-thumb {
  background: oklch(var(--bc) / 0.2);
  border-radius: 3px;
}

.docs-nav::-webkit-scrollbar-thumb:hover {
  background: oklch(var(--bc) / 0.3);
}

.docs-category-toggle:focus {
  outline: 2px solid oklch(var(--p));
  outline-offset: 2px;
}

.docs-category-items {
  transition: display 0.2s ease-in-out;
}

/* Documentation Search Styles - DaisyUI Compatible */

.search-results {
  position: absolute;
  top: calc(100% + 4px);
  left: 0;
  right: 0;
  @apply bg-base-100 border border-base-300 rounded-box shadow-xl;
  max-height: 400px;
  overflow-y: auto;
  z-index: 1000;
}

.search-results.hidden {
  display: none;
}

.search-results-header {
  padding: 8px 12px;
  @apply text-xs text-base-content/60 border-b border-base-300 bg-base-200;
  font-weight: 500;
}

.search-result-item {
  display: block;
  padding: 8px 12px;
  @apply border-b border-base-300 no-underline;
  color: inherit;
  transition: background-color 0.15s ease;
}

.search-result-item:last-child {
  border-bottom: none;
}

.search-result-item:hover {
  @apply bg-base-200;
}

.search-result-title {
  @apply font-semibold text-sm text-base-content;
  margin-bottom: 2px;
}

.search-result-category {
  @apply text-xs text-base-content/50;
  margin-bottom: 4px;
}

.search-result-snippet {
  @apply text-xs text-base-content/70;
  line-height: 1.4;
}

.search-no-results {
  padding: 16px 12px;
  text-align: center;
  @apply text-base-content/60 text-xs;
}

.search-result-item mark {
  @apply bg-warning/20 text-warning-content;
  padding: 1px 3px;
  border-radius: 2px;
  font-weight: 600;
}

.search-results::-webkit-scrollbar {
  width: 6px;
}

.search-results::-webkit-scrollbar-track {
  @apply bg-base-200;
  border-radius: 0 8px 8px 0;
}

.search-results::-webkit-scrollbar-thumb {
  background: oklch(var(--bc) / 0.2);
  border-radius: 3px;
}

.search-results::-webkit-scrollbar-thumb:hover {
  background: oklch(var(--bc) / 0.3);
}

@media (max-width: 1024px) {
  .search-results {
    position: fixed;
    top: auto;
    left: 0;
    right: 0;
    bottom: 0;
    max-height: 60vh;
    border-radius: 16px 16px 0 0;
  }
}
</style>
{% endblock %}
