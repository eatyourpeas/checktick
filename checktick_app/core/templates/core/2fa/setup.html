{% extends 'base.html' %}
{% load i18n %}

{% block title %}{% trans "Set Up Two-Factor Authentication" %} - CheckTick{% endblock %}

{% block content %}
<div class="prose max-w-none">
  <h1 class="inline-flex items-center gap-2 text-base-content">
    {% include "components/icons/shield-check.html" with classes="w-6 h-6 text-base-content" only %}
    <span>{% trans "Set Up Two-Factor Authentication" %}</span>
  </h1>
</div>

<div class="mt-6 max-w-xl">
  <div class="alert alert-info mb-6">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
    </svg>
    <div>
      <h3 class="font-bold">{% trans "2FA is required" %}</h3>
      <p class="text-sm">{% trans "As a healthcare application, CheckTick requires two-factor authentication for all password-based accounts to protect sensitive data." %}</p>
    </div>
  </div>

  <div class="card bg-base-100 shadow">
    <div class="card-body">
      <h2 class="card-title text-base-content">{% trans "Step 1: Scan QR Code" %}</h2>
      <p class="opacity-80">
        {% trans "Use your authenticator app to scan this QR code. We recommend Google Authenticator, Authy, or 1Password." %}
      </p>

      <div class="flex justify-center my-6">
        <div class="bg-white p-4 rounded-lg">
          <img src="data:image/png;base64,{{ qr_code }}" alt="{% trans 'QR Code for 2FA setup' %}" class="w-48 h-48" />
        </div>
      </div>

      <div class="divider">{% trans "OR" %}</div>

      <div class="form-control">
        <label class="label">
          <span class="label-text font-semibold">{% trans "Manual entry code:" %}</span>
        </label>
        <div class="input input-bordered font-mono text-sm flex items-center justify-center select-all">
          {{ secret_display }}
        </div>
        <label class="label">
          <span class="label-text-alt opacity-70">{% trans "If you can't scan the QR code, enter this code manually in your authenticator app." %}</span>
        </label>
      </div>
    </div>
  </div>

  <div class="card bg-base-100 shadow mt-6">
    <div class="card-body">
      <h2 class="card-title text-base-content">{% trans "Step 2: Verify" %}</h2>
      <p class="opacity-80">{% trans "Enter the 6-digit code from your authenticator app to complete setup." %}</p>

      <form method="post" class="mt-4">
        {% csrf_token %}
        <div class="form-control">
          <label class="label">
            <span class="label-text">{% trans "Verification Code" %}</span>
          </label>
          <input type="text"
                 name="token"
                 class="input input-bordered font-mono text-lg tracking-widest text-center"
                 placeholder="000000"
                 maxlength="6"
                 pattern="[0-9]{6}"
                 inputmode="numeric"
                 autocomplete="one-time-code"
                 required
                 autofocus />
        </div>

        <div class="mt-6 flex gap-3">
          <button type="submit" class="btn btn-primary">
            {% include "components/icons/shield-check.html" with classes="w-4 h-4 mr-2" only %}
            {% trans "Enable 2FA" %}
          </button>
          <a href="{% url 'logout' %}" class="btn btn-ghost">{% trans "Sign Out" %}</a>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}
